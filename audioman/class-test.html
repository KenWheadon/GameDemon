<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio Manager - Simple Test</title>
    <link rel="stylesheet" href="audio-manager.css" />
    <style>
      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        margin: 0;
        padding: 40px;
        min-height: 100vh;
        text-align: center;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      h1 {
        color: #48dbfb;
        margin-bottom: 30px;
        font-size: 32px;
      }

      .audio-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin: 30px 0;
      }

      .audio-btn {
        background: linear-gradient(135deg, #48dbfb 0%, #0abde3 100%);
        border: none;
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s ease;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .audio-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(72, 219, 251, 0.4);
      }

      .audio-btn.music {
        background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
      }

      .audio-btn.sfx {
        background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
      }

      .audio-btn.playing {
        background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      .controls {
        margin: 40px 0;
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .control-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .control-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .status {
        background: rgba(0, 0, 0, 0.3);
        padding: 20px;
        border-radius: 10px;
        margin-top: 30px;
        font-family: "Courier New", monospace;
        text-align: left;
      }

      .loading {
        font-size: 18px;
        color: #48dbfb;
      }

      .error {
        color: #ff6b6b;
      }

      .success {
        color: #00b894;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéµ Audio Manager Test</h1>
      <p class="loading" id="status">Initializing audio system...</p>

      <div class="controls">
        <button class="control-btn" onclick="stopAll()">‚èπÔ∏è Stop All</button>
        <button class="control-btn" onclick="toggleMute()" id="mute-btn">
          üîä Mute
        </button>
      </div>

      <div class="audio-grid" id="audio-grid">
        <!-- Audio buttons will be generated here -->
      </div>

      <div class="status" id="log">
        <div>Loading audio files...</div>
      </div>
    </div>

    <script src="Audio-Manager.js"></script>
    <script src="Audio-Manager-UI.js"></script>

    <script>
      let audioManager = null;
      let audioUI = null;
      let currentlyPlaying = null;

      // List of common MP3 files to check for
      const testFiles = [
        "test.mp3",
        "music.mp3",
        "sound.mp3",
        "audio.mp3",
        "sample.mp3",
        "demo.mp3",
        "click.mp3",
        "beep.mp3",
        "tone.mp3",
        "alert.mp3",
        "notification.mp3",
        "success.mp3",
        "error.mp3",
        "menu.mp3",
        "level1.mp3",
        "background.mp3",
        "effect.mp3",
      ];

      // Auto-initialize on page load
      document.addEventListener("DOMContentLoaded", async () => {
        await initializeAudio();
      });

      async function initializeAudio() {
        try {
          log("üöÄ Initializing AudioManager...", "info");

          // Initialize audio manager
          audioManager = new AudioManager({
            enableDebugLogs: false,
            autoPreload: false,
          });

          await audioManager.init();

          // Create simple UI (just floating button)
          audioUI = new AudioManagerUI(audioManager, {
            floatingButton: true,
            enableNotifications: false,
          });

          log("‚úÖ Audio system ready!", "success");

          // Scan for MP3 files
          await scanForAudioFiles();
        } catch (error) {
          log(`‚ùå Failed to initialize: ${error.message}`, "error");
        }
      }

      async function scanForAudioFiles() {
        log("üîç Scanning for MP3 files...", "info");
        document.getElementById("status").textContent =
          "Scanning for audio files...";

        const foundFiles = [];
        const grid = document.getElementById("audio-grid");

        // Test each potential file
        for (const filename of testFiles) {
          try {
            const exists = await checkFileExists(filename);
            if (exists) {
              foundFiles.push(filename);
              log(`üìÅ Found: ${filename}`, "success");
            }
          } catch (error) {
            // File doesn't exist, skip silently
          }
        }

        if (foundFiles.length === 0) {
          document.getElementById("status").innerHTML = `
                    <div class="error">No MP3 files found in root folder!</div>
                    <div style="margin-top: 10px; font-size: 14px;">
                        Add some MP3 files to the root folder and refresh.<br>
                        Checked for: ${testFiles.slice(0, 5).join(", ")}...
                    </div>
                `;
          return;
        }

        // Set up audio files
        const audioFiles = {
          backgroundMusic: {},
          soundEffects: {},
        };

        foundFiles.forEach((filename) => {
          const key = filename.replace(".mp3", "");
          // Classify as music or sound effect based on name
          if (
            filename.includes("music") ||
            filename.includes("background") ||
            filename.includes("level") ||
            filename.includes("menu")
          ) {
            audioFiles.backgroundMusic[key] = filename;
          } else {
            audioFiles.soundEffects[key] = filename;
          }
        });

        audioManager.setAudioFiles(audioFiles);

        // Create buttons for each file
        foundFiles.forEach((filename) => {
          createAudioButton(filename, grid);
        });

        document.getElementById("status").innerHTML = `
                <div class="success">Found ${foundFiles.length} audio files!</div>
                <div style="margin-top: 10px; font-size: 12px;">
                    Click any button to test playback
                </div>
            `;

        log(`üéµ Ready to test ${foundFiles.length} audio files`, "success");
      }

      async function checkFileExists(filename) {
        return new Promise((resolve) => {
          const audio = new Audio(filename);

          const timeout = setTimeout(() => {
            cleanup();
            resolve(false);
          }, 2000);

          const cleanup = () => {
            clearTimeout(timeout);
            audio.removeEventListener("canplaythrough", onLoad);
            audio.removeEventListener("error", onError);
          };

          const onLoad = () => {
            cleanup();
            resolve(true);
          };

          const onError = () => {
            cleanup();
            resolve(false);
          };

          audio.addEventListener("canplaythrough", onLoad);
          audio.addEventListener("error", onError);
          audio.load();
        });
      }

      function createAudioButton(filename, container) {
        const key = filename.replace(".mp3", "");
        const isMusic =
          filename.includes("music") ||
          filename.includes("background") ||
          filename.includes("level") ||
          filename.includes("menu");

        const button = document.createElement("button");
        button.className = `audio-btn ${isMusic ? "music" : "sfx"}`;
        button.innerHTML = `
                <div>
                    <div style="font-size: 20px; margin-bottom: 5px;">
                        ${isMusic ? "üéµ" : "üîä"}
                    </div>
                    <div>${key}</div>
                    <div style="font-size: 11px; opacity: 0.8; margin-top: 3px;">
                        ${isMusic ? "Music" : "Sound"}
                    </div>
                </div>
            `;

        button.onclick = () => playAudio(key, filename, isMusic, button);
        container.appendChild(button);
      }

      async function playAudio(key, filename, isMusic, button) {
        try {
          // Stop any currently playing audio
          if (currentlyPlaying) {
            currentlyPlaying.classList.remove("playing");
            if (isMusic) {
              audioManager.stopBackgroundMusic(false);
            }
          }

          // Load the audio if needed
          if (isMusic && !audioManager.backgroundMusic.has(key)) {
            log(`Loading background music: ${filename}`, "info");
            await audioManager.loadBackgroundMusic(key, filename);
          } else if (!isMusic && !audioManager.soundEffects.has(key)) {
            log(`Loading sound effect: ${filename}`, "info");
            await audioManager.loadSoundEffect(key, filename);
          }

          // Play the audio
          if (isMusic) {
            const success = audioManager.playBackgroundMusic(key, false, true);
            if (success) {
              button.classList.add("playing");
              currentlyPlaying = button;
              log(`üéµ Playing music: ${filename}`, "success");
            } else {
              log(`‚ùå Failed to play music: ${filename}`, "error");
            }
          } else {
            const success = audioManager.playSoundEffect(key, 1.0);
            if (success) {
              log(`üîä Playing sound: ${filename}`, "success");
              // Flash the button briefly
              button.classList.add("playing");
              setTimeout(() => button.classList.remove("playing"), 1000);
            } else {
              log(`‚ùå Failed to play sound: ${filename}`, "error");
            }
          }
        } catch (error) {
          log(`‚ùå Error playing ${filename}: ${error.message}`, "error");
        }
      }

      function stopAll() {
        if (audioManager) {
          audioManager.stopBackgroundMusic(false);
          if (currentlyPlaying) {
            currentlyPlaying.classList.remove("playing");
            currentlyPlaying = null;
          }
          log("‚èπÔ∏è Stopped all audio", "info");
        }
      }

      function toggleMute() {
        if (audioManager) {
          const isMuted = audioManager.toggleMute();
          document.getElementById("mute-btn").textContent = isMuted
            ? "üîá Unmute"
            : "üîä Mute";
          log(
            `${isMuted ? "üîá" : "üîä"} Audio ${isMuted ? "muted" : "unmuted"}`,
            "info"
          );
        }
      }

      function log(message, type = "info") {
        const logDiv = document.getElementById("log");
        const entry = document.createElement("div");
        entry.className = type;
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logDiv.appendChild(entry);
        logDiv.scrollTop = logDiv.scrollHeight;

        // Keep only last 20 messages
        while (logDiv.children.length > 20) {
          logDiv.removeChild(logDiv.firstChild);
        }
      }
    </script>
  </body>
</html>
