<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Combat System - Demo</title>
    <link rel="stylesheet" href="combat.css" />
    <style>
      /* Additional demo-specific styles */
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        font-family: "Comic Sans MS", cursive, sans-serif;
        color: white;
        min-height: 100vh;
      }

      .demo-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .demo-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .demo-title {
        font-size: 3em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .demo-subtitle {
        font-size: 1.2em;
        opacity: 0.8;
        margin-bottom: 20px;
      }

      .demo-controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .demo-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid white;
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .demo-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      .demo-btn:active {
        transform: scale(0.95);
      }

      .demo-info {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        text-align: center;
      }

      /* Victory/Defeat state styles */
      .combat-container.victory-state {
        border-color: gold;
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        animation: victoryGlow 2s ease-in-out infinite alternate;
      }

      .combat-container.defeat-state {
        border-color: #e74c3c;
        box-shadow: 0 0 30px rgba(231, 76, 60, 0.6);
        filter: grayscale(0.5);
      }

      @keyframes victoryGlow {
        0% {
          box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }
        100% {
          box-shadow: 0 0 50px rgba(255, 215, 0, 0.9);
        }
      }

      /* Victory particle effect */
      @keyframes victorySparkle {
        0%,
        100% {
          transform: translateY(0) rotate(0deg) scale(1);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        50% {
          transform: translateY(-50px) rotate(180deg) scale(1.5);
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
      }

      /* Screen shake effect */
      .combat-container.screen-shake {
        animation: screenShake 0.5s ease-in-out;
      }

      @keyframes screenShake {
        0%,
        100% {
          transform: translateX(0);
        }
        10% {
          transform: translateX(-10px) rotate(-1deg);
        }
        20% {
          transform: translateX(10px) rotate(1deg);
        }
        30% {
          transform: translateX(-8px) rotate(-1deg);
        }
        40% {
          transform: translateX(8px) rotate(1deg);
        }
        50% {
          transform: translateX(-6px) rotate(-0.5deg);
        }
        60% {
          transform: translateX(6px) rotate(0.5deg);
        }
        70% {
          transform: translateX(-4px);
        }
        80% {
          transform: translateX(4px);
        }
        90% {
          transform: translateX(-2px);
        }
      }

      /* Malfunction state */
      .combat-action.malfunctioned {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        border-color: #ff4757;
        animation: malfunctionPulse 1s infinite;
        opacity: 0.5;
        pointer-events: none;
      }

      @keyframes malfunctionPulse {
        0%,
        100% {
          box-shadow: 0 0 5px rgba(255, 107, 107, 0.5);
        }
        50% {
          box-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
        }
      }

      /* Action selected feedback */
      .combat-action.action-selected {
        transform: scale(1.1);
        border-color: #48dbfb;
        box-shadow: 0 0 20px rgba(72, 219, 251, 0.6);
      }

      /* Battle phase states */
      .combat-container.battle-starting {
        animation: battleStart 1.5s ease-out;
      }

      @keyframes battleStart {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        50% {
          opacity: 0.7;
          transform: scale(1.1);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Demo stats display */
      .demo-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stat-label {
        font-size: 12px;
        opacity: 0.8;
        margin-bottom: 5px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #48dbfb;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .demo-title {
          font-size: 2em;
        }

        .demo-controls {
          flex-direction: column;
          align-items: center;
        }

        .demo-btn {
          width: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <div class="demo-header">
        <h1 class="demo-title">‚öîÔ∏è Enhanced Combat System</h1>
        <p class="demo-subtitle">
          Advanced turn-based combat with rich visual feedback
        </p>
      </div>

      <div class="demo-controls">
        <button class="demo-btn" onclick="startDemo()">
          üéÆ Start Demo Battle
        </button>
        <button class="demo-btn" onclick="startBossDemo()">
          üëë Boss Battle
        </button>
        <button class="demo-btn" onclick="startMageDemo()">
          üßô Mage vs Rogue
        </button>
        <button class="demo-btn" onclick="resetDemo()">üîÑ Reset</button>
        <button class="demo-btn" onclick="toggleMalfunction()">
          ‚ö° Toggle Malfunction
        </button>
      </div>

      <div class="demo-info">
        <p>
          <strong>Features:</strong> Animated health/energy bars ‚Ä¢ Floating
          damage numbers ‚Ä¢ Turn-based UI states ‚Ä¢ Status effects ‚Ä¢ Critical hits
          ‚Ä¢ Sound integration ‚Ä¢ Achievement hooks
        </p>
        <p>
          <strong>Controls:</strong> Click action buttons to select ‚Ä¢ Keyboard
          1-6 for quick actions ‚Ä¢ Hover for enhanced tooltips
        </p>
      </div>

      <!-- Combat Container -->
      <div class="combat-container">
        <!-- Fighters Area -->
        <div class="fighters-area">
          <!-- Player Fighter -->
          <div class="fighter-container player-fighter">
            <div class="fighter-card">
              <div class="fighter-name" id="player-name">Player Fighter</div>
              <div class="fighter-sprite" id="player-sprite">ü•ä</div>
              <div class="fighter-stats">
                <!-- HP Bar -->
                <div class="stat-container hp-bar">
                  <div class="stat-label-row">
                    <span class="stat-label">Health</span>
                    <span class="stat-values">
                      <span class="hp-text">100/100</span>
                    </span>
                  </div>
                  <div class="stat-bar">
                    <div class="hp-bar-fill" style="width: 100%"></div>
                    <div class="stat-text hp-text">100/100</div>
                  </div>
                </div>
                <!-- Energy Bar -->
                <div class="stat-container energy-bar">
                  <div class="stat-label-row">
                    <span class="stat-label">Energy</span>
                    <span class="stat-values">
                      <span class="energy-text">20/20</span>
                    </span>
                  </div>
                  <div class="stat-bar">
                    <div class="energy-bar-fill" style="width: 100%"></div>
                    <div class="stat-text energy-text">20/20</div>
                  </div>
                </div>
                <!-- Status Effects -->
                <div class="status-effects"></div>
              </div>
            </div>
          </div>

          <!-- Enemy Fighter -->
          <div class="fighter-container enemy-fighter">
            <div class="fighter-card">
              <div class="fighter-name" id="enemy-name">Enemy Fighter</div>
              <div class="fighter-sprite" id="enemy-sprite">üéØ</div>
              <div class="fighter-stats">
                <!-- HP Bar -->
                <div class="stat-container hp-bar">
                  <div class="stat-label-row">
                    <span class="stat-label">Health</span>
                    <span class="stat-values">
                      <span class="hp-text">80/80</span>
                    </span>
                  </div>
                  <div class="stat-bar">
                    <div class="hp-bar-fill" style="width: 100%"></div>
                    <div class="stat-text hp-text">80/80</div>
                  </div>
                </div>
                <!-- Energy Bar -->
                <div class="stat-container energy-bar">
                  <div class="stat-label-row">
                    <span class="stat-label">Energy</span>
                    <span class="stat-values">
                      <span class="energy-text">15/15</span>
                    </span>
                  </div>
                  <div class="stat-bar">
                    <div class="energy-bar-fill" style="width: 100%"></div>
                    <div class="stat-text energy-text">15/15</div>
                  </div>
                </div>
                <!-- Status Effects -->
                <div class="status-effects"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Turn Indicator -->
        <div class="turn-indicator">Turn 1 - Select Actions</div>

        <!-- Actions Area -->
        <div class="actions-area">
          <h3 class="actions-title">Choose Your Actions</h3>
          <div class="action-buttons">
            <!-- Light Attack -->
            <button
              class="combat-action"
              data-action="light_attack"
              data-action-type="attack"
            >
              <span class="action-icon">üëä</span>
              <span class="action-name">Quick Strike</span>
              <span class="action-cost">2</span>
            </button>

            <!-- Heavy Attack -->
            <button
              class="combat-action"
              data-action="heavy_attack"
              data-action-type="attack"
            >
              <span class="action-icon">üí•</span>
              <span class="action-name">Power Strike</span>
              <span class="action-cost">4</span>
            </button>

            <!-- Defend -->
            <button
              class="combat-action"
              data-action="defend"
              data-action-type="defense"
            >
              <span class="action-icon">üõ°Ô∏è</span>
              <span class="action-name">Defend</span>
              <span class="action-cost">1</span>
            </button>

            <!-- Heal -->
            <button
              class="combat-action"
              data-action="heal"
              data-action-type="recovery"
            >
              <span class="action-icon">üíö</span>
              <span class="action-name">Heal</span>
              <span class="action-cost">3</span>
            </button>

            <!-- Power Up -->
            <button
              class="combat-action"
              data-action="powerup"
              data-action-type="buff"
            >
              <span class="action-icon">‚ö°</span>
              <span class="action-name">Power Up</span>
              <span class="action-cost">2</span>
            </button>

            <!-- Restore Energy -->
            <button
              class="combat-action"
              data-action="restore_energy"
              data-action-type="recovery"
            >
              <span class="action-icon">üîÑ</span>
              <span class="action-name">Focus</span>
              <span class="action-cost">0</span>
            </button>
          </div>

          <!-- Selected Actions Display -->
          <div class="selected-actions">
            <div class="selected-actions-title">Selected Actions</div>
            <div class="player-selected-actions"></div>
            <div class="enemy-selected-actions"></div>
          </div>
        </div>

        <!-- Animation Layer -->
        <div class="animation-layer"></div>
      </div>

      <!-- Combat Tooltip -->
      <div class="combat-tooltip">
        <div class="tooltip-header">
          <span class="tooltip-icon">üëä</span>
          <span class="tooltip-name">Action Name</span>
        </div>
        <div class="tooltip-description">Action description goes here</div>
        <div class="tooltip-stats">
          <div>Energy Cost: <span>2</span></div>
          <div>Damage: <span>25</span></div>
        </div>
      </div>

      <!-- Demo Statistics -->
      <div class="demo-stats">
        <div class="stat-card">
          <div class="stat-label">Battles Won</div>
          <div class="stat-value" id="battles-won">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Damage</div>
          <div class="stat-value" id="total-damage">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Favorite Action</div>
          <div class="stat-value" id="favorite-action">None</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Average Battle Length</div>
          <div class="stat-value" id="avg-battle-length">0</div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="Combat.js"></script>
    <script src="Combat-Manager.js"></script>
    <script>
      // Demo Game Class
      class DemoGame {
        constructor() {
          this.gameId = "enhanced-combat-demo";
          this.setupCombat();
          this.setupAudio();
        }

        setupCombat() {
          this.combatManager = new CombatManager(this, {
            enableDebugLogs: true,
            enableSoundEffects: true,
            enableMalfunction: false,
          });

          // Set up event handlers
          this.onBattleEnd = (data) => {
            console.log("Battle ended:", data.winner);
            this.updateDemoStats();

            setTimeout(() => {
              if (data.winner === "player") {
                alert(
                  "üéâ Victory! The enhanced combat system delivered an epic battle!"
                );
              } else {
                alert("üíÄ Defeat! But wasn't that a visually stunning battle?");
              }
            }, 1500);
          };

          this.onDamageDealt = (data) => {
            console.log("Damage dealt:", data.damage);
          };

          this.onCriticalHit = (data) => {
            console.log("üí• CRITICAL HIT!", data);
          };
        }

        setupAudio() {
          this.audioEnabled = false;
          this.sounds = {
            punch: () => this.playBeep(200, 100),
            heavy_hit: () => this.playBeep(150, 200),
            block: () => this.playBeep(300, 150),
            heal: () => this.playBeep(400, 300),
            powerup: () => this.playBeep(500, 250),
            energy: () => this.playBeep(350, 200),
            victory: () => this.playBeep(600, 500),
            critical: () => this.playBeep(100, 300),
            click: () => this.playBeep(800, 50),
          };
        }

        playSound(soundId, volume = 0.7) {
          if (this.sounds[soundId]) {
            this.sounds[soundId]();
          }
        }

        playMusic(musicId) {
          console.log("üéµ Playing music:", musicId);
        }

        playBeep(frequency, duration) {
          if (!this.audioEnabled) return;

          try {
            const context = new (window.AudioContext ||
              window.webkitAudioContext)();
            const oscillator = context.createOscillator();
            const gainNode = context.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(context.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = "sine";

            gainNode.gain.setValueAtTime(0.3, context.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              context.currentTime + duration / 1000
            );

            oscillator.start(context.currentTime);
            oscillator.stop(context.currentTime + duration / 1000);
          } catch (error) {
            console.warn("Audio not available");
          }
        }

        updateDemoStats() {
          const stats = this.combatManager.getStats();
          document.getElementById("battles-won").textContent = stats.battlesWon;
          document.getElementById("total-damage").textContent =
            stats.totalDamageDealt;
          document.getElementById("favorite-action").textContent =
            stats.favoriteAction || "None";
          document.getElementById("avg-battle-length").textContent =
            stats.averageBattleLength.toFixed(1);
        }
      }

      // Demo Functions
      let demoGame;

      function initDemo() {
        demoGame = new DemoGame();

        // Enable audio on first user interaction
        document.addEventListener(
          "click",
          () => {
            demoGame.audioEnabled = true;
          },
          { once: true }
        );
      }

      function startDemo() {
        if (!demoGame) initDemo();

        const player = demoGame.combatManager.createFighter("default");
        const enemy = demoGame.combatManager.createEnemy("basic");

        demoGame.combatManager.startBattle(player, enemy);
      }

      function startBossDemo() {
        if (!demoGame) initDemo();

        const player = demoGame.combatManager.createFighter("berserker");
        const enemy = demoGame.combatManager.createEnemy("boss");

        demoGame.combatManager.startBattle(player, enemy);
      }

      function startMageDemo() {
        if (!demoGame) initDemo();

        const player = demoGame.combatManager.createFighter("mage");
        const enemy = demoGame.combatManager.createEnemy("rogue");

        demoGame.combatManager.startBattle(player, enemy);
      }

      function resetDemo() {
        if (demoGame && demoGame.combatManager) {
          demoGame.combatManager.reset();
          demoGame.updateDemoStats();
        }

        // Reset UI
        const container = document.querySelector(".combat-container");
        container.className = "combat-container";

        alert("‚ú® Demo reset! Ready for a new battle.");
      }

      function toggleMalfunction() {
        if (!demoGame) initDemo();

        demoGame.combatManager.options.enableMalfunction =
          !demoGame.combatManager.options.enableMalfunction;
        const status = demoGame.combatManager.options.enableMalfunction
          ? "enabled"
          : "disabled";
        alert(
          `‚ö° Malfunction system ${status}! ${
            status === "enabled"
              ? "Some actions may randomly malfunction."
              : "All actions work normally."
          }`
        );
      }

      // Auto-initialize on load
      document.addEventListener("DOMContentLoaded", initDemo);

      // Debug functions for console
      window.demoGame = () => demoGame;
      window.testCritical = () => {
        if (demoGame && demoGame.combatManager.combat) {
          demoGame.combatManager.handleCriticalHit({
            defender: demoGame.combatManager.combat.state.fighters.enemy,
          });
        }
      };
    </script>
  </body>
</html>
